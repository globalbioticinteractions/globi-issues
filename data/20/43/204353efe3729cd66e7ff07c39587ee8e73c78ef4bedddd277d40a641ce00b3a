{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/1085","repository_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions","labels_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/1085/labels{/name}","comments_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/1085/comments","events_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/1085/events","html_url":"https://github.com/globalbioticinteractions/globalbioticinteractions/issues/1085","id":3223661732,"node_id":"I_kwDOACXQt87AJSyk","number":1085,"title":"Get List of Available GloBI Archive/Reviews (e.g., list of Zenodo deposit ids / content ids).","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-07-11T17:15:19Z","updated_at":"2025-07-28T15:24:07Z","closed_at":"2025-07-28T15:24:07Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"as discussed with @seltmann in following discussion:\n\nHow is it being done now?\n https://github.com/Big-Bee-Network/global-bee-interaction-data/blob/main/filter_and_count_bee_families.sh\n 1. Download tsv from GloBI (pre-aligned by GloBI's alignment workflow)\n 2. Filter on series of family names only (not lower taxa).\n 3. Obtain counts by familly\n 4. Column names based on GloBI schema.\n 5. Humanly push to Zenodo by uploading datasets to https://zenodo.org/records/14624975\n \n How do it differently?\n \n 1. Identify Families of Interest Andrenidae|Apidae|Colletidae|Halictidae|Megachilidae|Melittidae|Stenotritidae\n 2. Get List of Available GloBI Archive/Reviews (e.g., list of Zenodo deposit ids / content ids). \n\n     note: Can we include all of GBIF?\n\n 2. Align All GloBI names for indexed datasets using specified taxonomic alignment process \"greedy alignment\"\n\n     2.1  Alternative 1. use alignments embedded in the reviews   \n\n```\ncat\\\n <(curl \"https://zenodo.org/records/15198596/files/indexed-names-resolved.tsv.gz\" | gunzip | head -1 | gzip)\\\n <(curl \"https://zenodo.org/records/15198596/files/indexed-names-resolved.tsv.gz\" | gunzip | tail -n+2 | gzip)\\\n <(curl \"https://zenodo.org/records/15678181/files/indexed-names-resolved.tsv.gz\" | gunzip | tail -n+2 | gzip)\\\n  > indexed-names-resolved-all-no-header.tsv.gz\n``` \n\n```\ncat indexed-names-resolved-all-no-header.tsv.gz\\\n | gunzip\\\n | grep -E \"Andrenidae|Apidae|Colletidae|Halictidae|Megachilidae|Melittidae|Stenotritidae\"\\\n > indexed-names-resolved-bees-no-header.tsv.gz\n```\n\n```\ncat \\\n <(curl \"https://zenodo.org/records/15198596/files/indexed-names-resolved.tsv.gz\" | gunzip | head -1 | gzip)\\\n indexed-names-resolved-bees-no-header.tsv.gz\\\n > indexed-names-resolved-bees-with-header.tsv.gz\n```\n\ncat indexed-names-resolved-bees-with-header.tsv.gz\\\n  | gunzip\\\n  | cut -f7\\\n  | tail -n+2\\\n  | sort\\\n  | uniq -c\\\n  | sort -nr\n  \n  with result - \n  \n  23431 globalbioticinteractions/inaturalist\n   1135 globalbioticinteractions/ucsb-izc\n   \n   so this is a way to select the datasets, and we need a way to programmatically get the Zenodo id based on this. \n   \n   \n\"urn:lsid:globalbioticinteractions.org:dataset:globalbioticinteractions/inaturalist\"\n\nhttps://zenodo.org/api/records?q=%22urn:lsid:globalbioticinteractions.org:dataset:globalbioticinteractions/inaturalist%22\n\necho curl \"https://zenodo.org/api/records?q=%22urn:lsid:globalbioticinteractions.org:dataset:globalbioticinteractions/inaturalist%22\" | jq .hits[][0].id\n\n\n\n\ncat indexed-names-resolved-bees-no-header.tsv.gz | gunzip | head -2\n\n    check that this includes reference to iNaturalist\n\n\ncat indexed-names-resolved-bees-no-header.tsv.gz | gunzip | tail -1\n\n    check that includes UCSB IZC\n\n\n```\ncat indexed-names-resolved-bees-with-header.tsv.gz\\\n | gunzip\\\n | head -2\\\n | mlr --itsvlite --oxtab cat \n```\n\n\nprovidedExternalId      \nprovidedName            Epeolus inornatus\nprovidedCol2            \nprovidedCol3            \nprovidedCol4            Animalia | Arthropoda | Insecta | Hymenoptera | Apidae | Epeolus\nprovidedCol5            kingdom | phylum | class | order | family | genus\nprovidedCol6            globalbioticinteractions/inaturalist\nprovidedCol7            http://inaturalist.org/ is a place where you can record what you see in nature, meet other nature lovers, and learn about the natural world.\nprovidedCol8            https://www.inaturalist.org/observations/globi-observations-resource-relationships-dwca.zip\nprovidedCol9            2025-04-05T00:18:54.426Z\nprovidedCol10           9c649a789b3667dda799cda2a310ce0a925f36efb05572568bf06489bc993de0\nprovidedCol11           0.15.9\nrelationName            NONE\nresolvedCatalogName     col\nresolvedExternalId      \nresolvedName            Epeolus inornatus\nresolvedAuthorship      \nresolvedRank            \nresolvedCommonNames     \nresolvedPath            \nresolvedPathIds         \nresolvedPathNames       \nresolvedPathAuthorships \nresolvedExternalUrl     \n\n\n 3. Select GloBI Indexed Datasets containing Families of Interest (list of Zenodo DOIs and hashes, ~10-100 datasets)\n\n     note: contains names from all available catalogs. Important step so can filter by family names as not all data records have higher taxonomy included.\n\n     using indexed-names-resolved-bees.tsv.gz | gunzip | some magic > datasets-bees.txt\n\n 4. elton ls -f <(datasets of interest) > interactions-verbatim.tsv\n e.g.,\n ```\ncat\\\n <(curl \"https://zenodo.org/records/15198596/files/indexed-interactions.tsv.gz\" | gunzip | head -1 | gzip)\\\n <(curl --silent \"https://zenodo.org/records/15198596/files/indexed-interactions.tsv.gz\" | gunzip | tail -n+2 | gzip)\\\n <(curl --silent \"https://zenodo.org/records/15678181/files/indexed-interactions.tsv.gz\" | gunzip | tail -n+2 | gzip)\\\n  > indexed-interactions-concat.tsv.gz\n``` \nnote: this concatenates datasets where a family name was found. Also provides a list of the datasets used to create the dataset.\ncat indexed-interactions-concat.tsv.gz | gunzip | wc -l\n1034546\n\ncat  indexed-interactions-concat.tsv.gz | gunzip | head -1\nargumentTypeId    sourceOccurrenceId    sourceCatalogNumber    sourceCollectionCode    sourceCollectionId    sourceInstitutionCode    sourceTaxonId    sourceTaxonName    sourceTaxonRank    sourceTaxonPathIds    sourceTaxonPath    sourceTaxonPathNames    sourceBodyPartId    sourceBodyPartName    sourceLifeStageId    sourceLifeStageName    sourceSexId    sourceSexName    interactionTypeId    interactionTypeName    targetOccurrenceId    targetCatalogNumber    targetCollectionCode    targetCollectionId    targetInstitutionCode    targetTaxonId    targetTaxonName    targetTaxonRank    targetTaxonPathIds    targetTaxonPath    targetTaxonPathNames    targetBodyPartId    targetBodyPartName    targetLifeStageId    targetLifeStageName    targetSexId    targetSexName    basisOfRecordId    basisOfRecordName    http://rs.tdwg.org/dwc/terms/eventDate    decimalLatitude    decimalLongitude    localityId    localityName    referenceDoi    referenceUrl    referenceCitation    namespace    citation    archiveURI    lastSeenAt    contentHash    eltonVersion\n\n \n 5. upload to Zenodo at https://zenodo.org/records/14624975\n 6. Let collaborators know where it is\n ---- transition to manuscript specific methods ----\n 5. apply whatever \"real\" taxonomic alignment process on interactions-verbatim.tsv","closed_by":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/1085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/1085/timeline","performed_via_github_app":null,"state_reason":"completed"}