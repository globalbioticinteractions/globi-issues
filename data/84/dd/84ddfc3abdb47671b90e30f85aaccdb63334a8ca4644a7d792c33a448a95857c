[{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/563352785","html_url":"https://github.com/globalbioticinteractions/globalbioticinteractions/issues/433#issuecomment-563352785","issue_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/433","id":563352785,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MzM1Mjc4NQ==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-09T17:48:39Z","updated_at":"2019-12-09T17:48:39Z","body":"Using helpful details provided by @campmlc , I was able to find the root cause of the unexpected behavior:\r\n\r\nIn a recent upgrade to v2.3 Cypher queries (14 Nov 2019, see https://github.com/globalbioticinteractions/globalbioticinteractions/releases/tag/v0.13.0), the following query was introduced:\r\n\r\n```cypher\r\nCYPHER 2.3 START sourceTaxon = node:taxonPaths('path:\\\"Myodes rutilus\\\"') MATCH sourceTaxon<-[:CLASSIFIED_AS]-sourceSpecimen-[interaction:HAS_PARASITE|HAS_PATHOGEN|HAS_ENDOPARASITE|HAS_HYPERPARASITE|HAS_HYPERPARASITOID|HAS_ECTOPARASITE|HAS_KLEPTOPARASITE|HAS_PARASITOID|HAS_ENDOPARASITOID|HAS_ECTOPARASITOID]->targetSpecimen-[:CLASSIFIED_AS]->targetTaxon, sourceSpecimen<-[collected_rel:COLLECTED]-study OPTIONAL MATCH sourceSpecimen-[:COLLECTED_AT]->loc WHERE (exists(targetTaxon.externalIds) AND ANY(x IN split(targetTaxon.externalIds, '|') WHERE trim(x) in ['Heligmosomum mixtum'])) RETURN sourceTaxon.externalId as source_taxon_external_id,sourceTaxon.name as source_taxon_name,sourceTaxon.path as source_taxon_path,sourceSpecimen.lifeStageLabel as source_specimen_life_stage,sourceSpecimen.basisOfRecordLabel as source_specimen_basis_of_record,interaction.label as interaction_type,targetTaxon.externalId as target_taxon_external_id,targetTaxon.name as target_taxon_name,targetTaxon.path as target_taxon_path,targetSpecimen.lifeStageLabel as target_specimen_life_stage,targetSpecimen.basisOfRecordLabel as target_specimen_basis_of_record,loc.latitude as latitude,loc.longitude as longitude,study.title as study_title SKIP 0 LIMIT 1024\r\n```\r\nthe \"optional match\" was introduced during the upgrade and (incorrectly) conditioned the query to only include those specifying the target taxon (in this case *Heligmosomum mixtum*) if explicit lat/lng coordinates are known. This is consistent with why http://arctos.database.museum/guid/MSB:Para:15554 was (incorrectly) included in the results: the record does not include explicit lat/lng coordinates . \r\n\r\nI am working on applying a fix that makes sure that the target taxon query criteria are always applied using a queries like:\r\n\r\n```\r\nCYPHER 2.3 START sourceTaxon = node:taxonPaths('path:\\\"Myodes rutilus\\\"') MATCH sourceTaxon<-[:CLASSIFIED_AS]-sourceSpecimen-[interaction:HAS_PARASITE|HAS_PATHOGEN|HAS_ENDOPARASITE|HAS_HYPERPARASITE|HAS_HYPERPARASITOID|HAS_ECTOPARASITE|HAS_KLEPTOPARASITE|HAS_PARASITOID|HAS_ENDOPARASITOID|HAS_ECTOPARASITOID]->targetSpecimen-[:CLASSIFIED_AS]->targetTaxon, sourceSpecimen<-[collected_rel:COLLECTED]-study WHERE (exists(targetTaxon.externalIds) AND ANY(x IN split(targetTaxon.externalIds, '|') WHERE trim(x) in ['Heligmosomum mixtum'])) OPTIONAL MATCH sourceSpecimen-[:COLLECTED_AT]->loc RETURN sourceTaxon.externalId as source_taxon_external_id,sourceTaxon.name as source_taxon_name,sourceTaxon.path as source_taxon_path,sourceSpecimen.lifeStageLabel as source_specimen_life_stage,sourceSpecimen.basisOfRecordLabel as source_specimen_basis_of_record,interaction.label as interaction_type,targetTaxon.externalId as target_taxon_external_id,targetTaxon.name as target_taxon_name,targetTaxon.path as target_taxon_path,targetSpecimen.lifeStageLabel as target_specimen_life_stage,targetSpecimen.basisOfRecordLabel as target_specimen_basis_of_record,loc.latitude as latitude,loc.longitude as longitude,study.title as study_title SKIP 0 LIMIT 1024\r\n```\r\nNotice that the where clause no longer is included in the \"optional match\" . \r\n\r\nWorking on a fix now.\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/563352785/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/563378028","html_url":"https://github.com/globalbioticinteractions/globalbioticinteractions/issues/433#issuecomment-563378028","issue_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/433","id":563378028,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MzM3ODAyOA==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-09T18:51:36Z","updated_at":"2019-12-09T18:51:36Z","body":"I've implemented and deployed a fix. \r\n\r\nNow, when querying https://www.globalbioticinteractions.org/?accordingTo=http%3A%2F%2Farctos.database.museum%2Fguid%2FMSB%3APara%3A26354&interactionType=interactsWith , the results no longer include the unexpected reference to http://arctos.database.museum/guid/MSB:Para:15554 . Some spot checks (e.g., http://arctos.database.museum/guid/MSB:Para:25530 http://arctos.database.museum/guid/MSB:Para:25520 and http://arctos.database.museum/guid/MSB:Para:26354) only include records that support the claim in question, in this case: *Heligmosomum mixtum* parasite of *Myodes rutilus* .\r\n\r\nSee also included screenshot - \r\n\r\n![Screenshot from 2019-12-09 10-45-31](https://user-images.githubusercontent.com/1084872/70463203-52bd8480-1a71-11ea-8a61-41a6197b06cc.png)\r\n\r\n\r\n\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/563378028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/563500617","html_url":"https://github.com/globalbioticinteractions/globalbioticinteractions/issues/433#issuecomment-563500617","issue_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/433","id":563500617,"node_id":"MDEyOklzc3VlQ29tbWVudDU2MzUwMDYxNw==","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-10T00:17:55Z","updated_at":"2019-12-10T00:17:55Z","body":"Bug fix confirmed by @campmlc by email , closing issue.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/563500617/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]