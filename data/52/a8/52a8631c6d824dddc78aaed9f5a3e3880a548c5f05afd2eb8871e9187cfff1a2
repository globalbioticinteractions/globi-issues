[{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/1843935413","html_url":"https://github.com/globalbioticinteractions/globalbioticinteractions/issues/949#issuecomment-1843935413","issue_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/949","id":1843935413,"node_id":"IC_kwDOACXQt85t6Di1","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-07T00:28:11Z","updated_at":"2023-12-07T00:45:17Z","body":"after various optimization via, \r\n 2677150b46a56ea9c5be845a7a1a54db401936a9\r\n 3edced81ff5295a58506469f50d8e986cd892c6c\r\n 92988dc9539d69e3c51993ac5993b2ee26e54c82\r\n 3268b1958e15aadcbc365ef5d129714bc7a87d6a\r\n 3b05a26b65d6493a141fa1dedea4d7060603f53d\r\n 366fc847a5a3056cf8e42159b5acd7400a86777b\r\n a8575ea717b7da40a643b73f09258fdaaeb74c83\r\n\r\nthe \"GC Overhead Limit Exceeded\" behavior is no longer detected in a recent indexing log -\r\n\r\n```\r\n [main] INFO org.eol.globi.data.DatasetImporterForRegistry - [globalbioticinteractions/inaturalist] is active, importing...\r\n [main] INFO org.eol.globi.data.DatasetImporterForRSS - including [http://iNaturalist.org is a place where you can record what you see in nature, meet other nature lovers, and learn about t>\r\n [main] INFO org.eol.globi.data.DatasetImporterForRSS - including [iNaturalist Taxa].\r\n [main] INFO org.eol.globi.data.DatasetImporterForRSS - including [http://iNaturalist.org is a place where you can record what you see in nature, meet other nature lovers, and learn about t>\r\n [main] INFO org.eol.globi.data.DatasetImporterForRSS - including [iNaturalist Taxa].\r\n [main] INFO org.eol.globi.util.DatasetImportUtil - indexing unresolved occurrence references of [rss.xml]...\r\n [main] INFO org.eol.globi.util.DatasetImportUtil - indexing unresolved occurrence references of [rss.xml] done: indexed [30702] unresolved occurrences\r\n [main] INFO org.eol.globi.util.DatasetImportUtil - indexing dependencies of [rss.xml]...\r\n [main] INFO org.eol.globi.util.DatasetImportUtil - indexing dependencies of [rss.xml] done: resolved [30702] occurrence references\r\n [main] INFO org.eol.globi.util.DatasetImportUtil - importing datasets for [rss.xml]...\r\n [main] INFO org.eol.globi.util.DatasetImportUtil - importing datasets for [rss.xml] done.\r\n [main] INFO org.eol.globi.data.DatasetImporterForRegistry - [globalbioticinteractions/inaturalist] imported in 705s\r\n```\r\n\r\nThe root cause appears to have been the creation of new strings. \r\n\r\nFor instance, every time the ```org.gbif.dwc.terms.Term:qualifiedName()``` is called, a new string is created. \r\n\r\nhttps://github.com/gbif/dwc-api/blob/a74c2790085ab1f0fcb2252ffd8d7217cde7fefa/src/main/java/org/gbif/dwc/terms/Term.java#L63C1-L65\r\n\r\n```\r\ndefault String qualifiedName() {\r\n    return namespace() + simpleName();\r\n}\r\n```\r\n\r\nTo prevent the creation of these millions and millions of strings, I created a term cache (similar to GBIF's TermFactory) that pre-computes the qualified name string. See https://github.com/globalbioticinteractions/globalbioticinteractions/blob/2677150b46a56ea9c5be845a7a1a54db401936a9/eol-globi-data-sources/src/main/java/org/eol/globi/data/DatasetImporterForDwCA.java#L1140-L1147 \r\n\r\nI am sure this solution can be optimized further, but at least for now the pressure on the garbage collector (GC) is somewhat reduced.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/1843935413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/1843944145","html_url":"https://github.com/globalbioticinteractions/globalbioticinteractions/issues/949#issuecomment-1843944145","issue_url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/949","id":1843944145,"node_id":"IC_kwDOACXQt85t6FrR","user":{"login":"jhpoelen","id":1084872,"node_id":"MDQ6VXNlcjEwODQ4NzI=","avatar_url":"https://avatars.githubusercontent.com/u/1084872?v=4","gravatar_id":"","url":"https://api.github.com/users/jhpoelen","html_url":"https://github.com/jhpoelen","followers_url":"https://api.github.com/users/jhpoelen/followers","following_url":"https://api.github.com/users/jhpoelen/following{/other_user}","gists_url":"https://api.github.com/users/jhpoelen/gists{/gist_id}","starred_url":"https://api.github.com/users/jhpoelen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhpoelen/subscriptions","organizations_url":"https://api.github.com/users/jhpoelen/orgs","repos_url":"https://api.github.com/users/jhpoelen/repos","events_url":"https://api.github.com/users/jhpoelen/events{/privacy}","received_events_url":"https://api.github.com/users/jhpoelen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-07T00:38:54Z","updated_at":"2023-12-07T00:41:08Z","body":"The changes also have appeared to speed up the indexing process. \r\n\r\nA largish DwC-A collection by USNM (~10M occurrences with >200k interaction claims) previously indexed in 1326s (22 min), now in 810s (or 13 min). \r\n\r\n```\r\nDec 06 23:47:24 [main] INFO org.eol.globi.data.DatasetImporterForRegistry - [globalbioticinteractions/usnm] imported in 1326s\r\nDec 07 00:33:45 [main] INFO org.eol.globi.data.DatasetImporterForRegistry - [globalbioticinteractions/usnm] imported in 810s\r\n```\r\n\r\niNaturalist with ~75M occurrences and >500k interaction claims completed in 705 s or about 12 min. \r\n\r\n```\r\n[main] INFO org.eol.globi.data.DatasetImporterForRegistry - [globalbioticinteractions/inaturalist] imported in 705s\r\n```","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/globalbioticinteractions/globalbioticinteractions/issues/comments/1843944145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]